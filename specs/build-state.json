{
  "lastSpec": "P1-04",
  "completed": ["P1-01", "P1-02", "P1-03", "P1-04"],
  "currentPillar": 1,
  "totalSpecs": 83,
  "patternsEstablished": [
    "dict[str, Any] for all unparameterized dicts",
    "type: ignore[attr-defined] for SDK imports without __all__",
    "pydantic_settings.BaseSettings for centralized config",
    "@lru_cache(maxsize=1) + get_settings() for config singleton",
    "get_settings.cache_clear() in tests for isolation",
    "structlog.get_logger(name) for all module-level loggers",
    "structlog.contextvars for correlation_id propagation",
    "ProcessorFormatter.wrap_for_formatter as final structlog processor",
    "try/finally with clear_correlation_id() at request boundaries",
    "_CONFIGURED flag reset in conftest.py for test isolation",
    "SecondBrainError base class with to_dict() serialization",
    "Defensive dict copy in error context attributes",
    "raise TypedError(...) from e for exception chaining in recall.py"
  ],
  "decisionsLog": [
    {
      "spec": "P1-01",
      "decision": "Use dict[str, Any] not TypedDict for model_dump() outputs and metadata dicts",
      "reason": "Accurate typing without premature TypedDict definitions — stronger typing deferred to dedicated specs"
    },
    {
      "spec": "P1-01",
      "decision": "type: ignore[attr-defined] for voyageai.Client, not a type stub",
      "reason": "Minimal maintenance burden, voyageai may publish stubs later"
    },
    {
      "spec": "P1-02",
      "decision": "All Settings fields optional with defaults, no eager validation at module level",
      "reason": "Tests run without .env file; lru_cache singleton validates on first get_settings() call"
    },
    {
      "spec": "P1-02",
      "decision": "Scope config.py to deps.py only, service files keep os.getenv fallback",
      "reason": "Service files have direct instantiation paths for testing; centralizing everything in one spec increases risk"
    },
    {
      "spec": "P1-03",
      "decision": "structlog with ProcessorFormatter for JSON rendering, not dual JSONRenderer",
      "reason": "Avoids double JSON rendering bug — structlog processors prepare dict, ProcessorFormatter renders once"
    },
    {
      "spec": "P1-03",
      "decision": "Conditional correlation_id set in planner (preserve upstream ID)",
      "reason": "MCP server sets request-level correlation_id; planner only sets if none exists to avoid overwriting"
    },
    {
      "spec": "P1-03",
      "decision": "unbind_contextvars for cleanup, not clear_contextvars",
      "reason": "clear_contextvars wipes ALL structlog contextvars; unbind only removes correlation_id key"
    },
    {
      "spec": "P1-04",
      "decision": "Narrow scope: only errors.py, recall.py, planner.py modified. Services keep swallow+degrade pattern",
      "reason": "Services intentionally catch exceptions internally for resilience. Adding typed raises would break graceful degradation."
    },
    {
      "spec": "P1-04",
      "decision": "Planner catches (SecondBrainError, ValidationError) instead of 5 manual exception types",
      "reason": "SecondBrainError covers all typed errors from recall.py; ValidationError needed for Pydantic RetrievalRequest construction"
    }
  ]
}
